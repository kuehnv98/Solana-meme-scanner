<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Solana Meme Scanner – Easy UI</title>
<style>
  body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, sans-serif; background:#0b0e13; color:#e7ecf2; margin:0 }
  header { position:sticky; top:0; background:#0f131a; border-bottom:1px solid #1c2533; padding:12px 16px }
  .wrap { max-width:1100px; margin:0 auto }
  .row { display:flex; gap:10px; align-items:center; flex-wrap:wrap }
  .pill { border:1px solid #2a3649; border-radius:999px; padding:4px 10px; font-size:13px }
  button, input[type=checkbox] { cursor:pointer }
  button { background:#152033; color:#e7ecf2; border:1px solid #27344a; border-radius:8px; padding:8px 12px }
  .grid { display:grid; grid-template-columns:1fr; gap:8px; padding:12px 0 }
  .card { display:grid; grid-template-columns:1fr repeat(4, 120px); gap:8px; align-items:center; background:#111824; border:1px solid #1c2533; border-radius:10px; padding:10px }
  .muted { color:#8ea0b5 }
  .error { color:#ff7d7d; white-space:pre-wrap }
  a { color:#7db2ff }
</style>
</head>
<body>
<header>
  <div class="wrap">
    <h1 style="margin:0 0 6px 0">Solana Meme Scanner – Easy UI</h1>
    <div class="row">
      <span class="pill" id="apiStatus">API: –</span>
      <span class="pill" id="counts">Pairs: –</span>
      <label class="pill"><input id="easy" type="checkbox"> Easy-Filter (Test)</label>
      <button id="btnRelax">Filter lockern</button>
      <button id="btnReset">Filter zurücksetzen</button>
      <button id="btnShowAll">Alles zeigen (roh)</button>
      <span class="muted" style="margin-left:auto">Quelle: https://icy-bush-6d1c.kuehn-v2020.workers.dev/</span>
    </div>
  </div>
</header>

<main class="wrap">
  <div id="err" class="error" style="display:none"></div>
  <div id="list" class="grid"></div>
</main>

<script>
const WORKER_URL = "https://icy-bush-6d1c.kuehn-v2020.workers.dev/";
const st = { pc5min: 2, pc1min: 10, liqMin: 1000, v5Min: 0, limit: 100 };

function qs(s){return document.querySelector(s)}
const elStatus = qs('#apiStatus');
const elCounts = qs('#counts');
const elErr = qs('#err');
const elList = qs('#list');
const elEasy = qs('#easy');

qs('#btnRelax').onclick = () => { st.pc5min = 1; st.pc1min = 5; st.liqMin = 0; st.v5Min = 0; refresh(); };
qs('#btnReset').onclick = () => { st.pc5min = 2; st.pc1min = 10; st.liqMin = 1000; st.v5Min = 0; refresh(); };
qs('#btnShowAll').onclick = () => { render(lastData?.pairs?.filter(p=>p.chainId==='solana').slice(0,50)||[]); };
elEasy.onchange = () => refresh();

let timer, lastData;

async function fetchData() {
  const t0 = performance.now();
  const res = await fetch(WORKER_URL, {headers:{accept:'application/json'}, cache:'no-store'});
  const t1 = performance.now();
  const latency = Math.round(t1 - t0);
  if (!res.ok) throw new Error(`HTTP ${res.status} ${res.statusText}`);
  const json = await res.json();
  elStatus.textContent = `API: OK (${latency}ms)`;
  return json;
}

function enrich(p) {
  const nz = (x,d=0)=> (x==null||isNaN(x)?d:Number(x));
  const b5=nz(p.txns?.m5?.buys), s5=nz(p.txns?.m5?.sells);
  const b1=nz(p.txns?.h1?.buys), s1=nz(p.txns?.h1?.sells);
  const v5=nz(p.volume?.m5), v1=nz(p.volume?.h1), v24=nz(p.volume?.h24);
  const pc5=nz(p.priceChange?.m5), pc1=nz(p.priceChange?.h1);
  const liq=nz(p.liquidity?.usd);
  const buy1=(b1+s1)?b1/(b1+s1):0.5;
  return Object.assign(p, { _b5:b5,_s5:s5,_b1:b1,_s1:s1,_v5:v5,_v1:v1,_v24:v24,_pc5:pc5,_pc1:pc1,_liq:liq,_buy1:buy1 });
}

function passEasy(p) { return p.chainId === 'solana'; }
function passStrict(p) {
  return p.chainId==='solana' && p._liq>=st.liqMin && p._v5>=st.v5Min && p._pc1>=st.pc1min && p._pc5>=st.pc5min && p._b1>=5;
}

function render(rows) {
  elList.innerHTML='';
  if (!rows.length) {
    const d = document.createElement('div');
    d.className='muted'; d.style.padding='16px'; d.textContent='Keine Treffer mit den aktuellen Filtern.';
    elList.appendChild(d); return;
  }
  rows.slice(0, st.limit).forEach(p=>{
    const div=document.createElement('div'); div.className='card';
    const fmt = (n,d=0)=> (n==null||isNaN(n)?'–':Number(n).toLocaleString(undefined,{maximumFractionDigits:d,minimumFractionDigits:d}));
    div.innerHTML = `
      <div><b>${p.baseToken?.symbol||'?'} / ${p.quoteToken?.symbol||''}</b> <span class="muted">(${
        p.chainId} · ${p.dexId})</span><br>
      <a href="${p.url}" target="_blank" rel="noopener">Dexscreener ↗</a></div>
      <div>Δ 5m <b>${fmt(p._pc5,2)}%</b></div>
      <div>Δ 1h <b>${fmt(p._pc1,2)}%</b></div>
      <div>Vol 5m <b>$${fmt(p._v5,0)}</b></div>
      <div>LP <b>$${fmt(p._liq,0)}</b></div>`;
    elList.appendChild(div);
  });
}

async function refresh() {
  try {
    elErr.style.display='none'; elErr.textContent='';
    lastData = await fetchData();
    const all = lastData?.pairs || [];
    const sol = all.filter(p=>p.chainId==='solana');
    const rows = sol.map(enrich).filter(elEasy.checked ? passEasy : passStrict);
    elCounts.textContent = `Pairs: erhalten ${all.length} | solana ${sol.length} | nach Filter ${rows.length}`;
    render(rows);
  } catch (e) {
    elStatus.textContent='API: FEHLER';
    elErr.style.display='block';
    elErr.textContent = String(e && e.message ? e.message : e);
    console.error(e);
  }
}

function start() { clearInterval(timer); refresh(); timer = setInterval(refresh, 15000); }
start();
</script>
</body>
</html>
