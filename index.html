<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Solana Meme Scanner – V1 (Takeover & Revival)</title>
  <meta name="description" content="Lightweight scanner for Solana pairs using DexScreener, with Takeover & Revival profiles and scoring."/>
  <style>
    :root {
      --bg:#0b0e13; --panel:#0f131a; --muted:#8ea0b5; --border:#1c2533; --text:#e7ecf2;
      --good:#7dffa0; --bad:#ff7d7d; --warn:#ffd37d;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,sans-serif;background:var(--bg);color:var(--text)}
    header{position:sticky;top:0;background:var(--panel);border-bottom:1px solid var(--border);padding:12px 16px;z-index:10}
    h1{margin:0;font-size:18px;letter-spacing:.3px}
    .sub{color:var(--muted);font-size:12px;margin-top:4px}
    .wrap{max-width:1200px;margin:0 auto}
    .controls{display:grid;grid-template-columns:repeat(8,minmax(120px,1fr));gap:8px;margin-top:12px}
    .controls label{font-size:12px;color:var(--muted)}
    input,select{width:100%;background:#0c1118;color:var(--text);border:1px solid var(--border);border-radius:8px;padding:8px}
    .tabs{display:flex;gap:8px;margin-top:8px}
    .tab{padding:8px 12px;border:1px solid var(--border);border-radius:999px;background:#0c1118;color:var(--text);cursor:pointer}
    .tab.active{outline:2px solid #2b6cff}
    main{padding:12px 16px}
    .grid{display:grid;grid-template-columns:1fr;gap:8px}
    .card{display:grid;grid-template-columns: 1.2fr repeat(7,1fr) auto;gap:8px;align-items:center;background:#111824;border:1px solid var(--border);border-radius:10px;padding:10px}
    .pill{font-size:12px;padding:2px 8px;border:1px solid #2a3649;border-radius:999px}
    .muted{color:var(--muted)}
    .score{font-weight:700}
    .ampel{font-weight:700}
    .ampel.green{color:var(--good)}
    .ampel.yellow{color:var(--warn)}
    .ampel.red{color:var(--bad)}
    .right{justify-self:end}
    .badges{display:flex;gap:6px;flex-wrap:wrap}
    .badge{font-size:11px;border:1px solid #32425a;border-radius:6px;padding:2px 6px}
    .row{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
    .error{color:var(--bad);padding:12px}
    footer{padding:16px;color:var(--muted);text-align:center}
    @media (max-width:980px){
      .card{grid-template-columns:1.5fr 1fr 1fr 1fr 1fr 1fr 1fr;grid-auto-rows:auto}
      .hide-sm{display:none}
    }
  </style>
</head>
<body>
  <header>
    <div class="wrap">
      <h1>Solana Meme Scanner – V1</h1>
      <div class="sub">Takeover (Community Pump) & Revival (Comeback) • DexScreener live • ohne Backend</div>
      <div class="tabs">
        <button class="tab active" data-mode="takeover">Community Takeover</button>
        <button class="tab" data-mode="revival">Revival</button>
        <div class="sub" style="margin-left:auto">Letztes Update: <span id="last-upd">–</span></div>
      </div>
      <div class="controls" id="controls">
        <!-- Common -->
        <label>Refresh (Sek.)<br/><input id="f-interval" type="number" min="5" value="15"/></label>
        <label>Limit Rows<br/><input id="f-limit" type="number" min="10" value="150"/></label>
        <label>Min LP (USD)<br/><input id="f-liq" type="number" min="0" value="5000"/></label>
        <label>Min Vol 5m (USD)<br/><input id="f-v5" type="number" min="0" value="1000"/></label>
        <label>Max Δ 5m (%)<br/><input id="f-pc5max" type="number" min="10" value="120"/></label>
        <!-- Takeover specific defaults (also used as baseline for Revival where applicable) -->
        <label class="mode-takeover">Max FDV (USD)<br/><input id="f-fdv-max" type="number" min="1" value="500000"/></label>
        <label class="mode-takeover">Min BuyRatio h1<br/><input id="f-br1" type="number" min="0" max="1" step="0.01" value="0.60"/></label>
        <label class="mode-takeover">Min Δ h1 (%)<br/><input id="f-pc1" type="number" min="0" value="40"/></label>
        <label class="mode-takeover">Min Δ 5m (%)<br/><input id="f-pc5" type="number" min="0" value="8"/></label>
        <label class="mode-revival" style="display:none">Min Alter (Tage)<br/><input id="f-age-days" type="number" min="7" value="7"/></label>
        <label class="mode-revival" style="display:none">Max Δ 24h (%)<br/><input id="f-pc24max" type="number" value="5"/></label>
        <label class="mode-revival" style="display:none">Min AccVol (x)<br/><input id="f-acc" type="number" step="0.1" value="3.0"/></label>
      </div>
    </div>
  </header>

  <main>
    <div class="wrap">
      <div id="list" class="grid"></div>
      <div id="err" class="error" style="display:none"></div>
    </div>
  </main>

  <footer>
    V1 • Client-only • Quelle: DexScreener Solana Pairs • Sortierung per Score (Ampel: ≥75 grün, 55–74 gelb)
  </footer>

<script>
// ========= Helpers =========
const elList = document.getElementById('list');
const elErr = document.getElementById('err');
const elLastUpd = document.getElementById('last-upd');
let MODE = 'takeover';
let timer;

const clamp01 = x => Math.max(0, Math.min(1, x));
const nz = (x, d=0) => (x==null || isNaN(x)) ? d : Number(x);

// UI
document.querySelectorAll('.tab').forEach(btn=>{
  btn.addEventListener('click',()=>{
    document.querySelectorAll('.tab').forEach(b=>b.classList.remove('active'));
    btn.classList.add('active');
    MODE = btn.dataset.mode;
    document.querySelectorAll('.mode-takeover').forEach(el=>el.style.display = (MODE==='takeover')?'block':'none');
    document.querySelectorAll('.mode-revival').forEach(el=>el.style.display = (MODE==='revival')?'block':'none');
    refresh();
  });
});

// Controls
const F = {
  interval: document.getElementById('f-interval'),
  limit: document.getElementById('f-limit'),
  liq: document.getElementById('f-liq'),
  v5: document.getElementById('f-v5'),
  pc5max: document.getElementById('f-pc5max'),
  // takeover
  fdvMax: document.getElementById('f-fdv-max'),
  br1: document.getElementById('f-br1'),
  pc1: document.getElementById('f-pc1'),
  pc5: document.getElementById('f-pc5'),
  // revival
  ageDays: document.getElementById('f-age-days'),
  pc24max: document.getElementById('f-pc24max'),
  acc: document.getElementById('f-acc'),
};

Object.values(F).forEach(i=> i && i.addEventListener('change', ()=>{
  if (['f-interval'].includes(i.id)) { start(); } else { refresh(); }
}));

function fmt(n,d=0){ if(n==null||isNaN(n)) return '–'; return Number(n).toLocaleString(undefined,{maximumFractionDigits:d, minimumFractionDigits:d}); }

// ========= Data fetch =========
async function fetchPairs(){
  const url = 'https://api.dexscreener.com/latest/dex/pairs/solana';
  const res = await fetch(url, { cache: 'no-store' });
  if (!res.ok) throw new Error('API ' + res.status);
  const data = await res.json();
  return data.pairs ?? [];
}

// ========= Feature logic =========
function enrich(p){
  const b5 = nz(p.txns?.m5?.buys), s5 = nz(p.txns?.m5?.sells);
  const b1 = nz(p.txns?.h1?.buys), s1 = nz(p.txns?.h1?.sells);
  const v5 = nz(p.volume?.m5), v1 = nz(p.volume?.h1), v24 = nz(p.volume?.h24);
  const pc5 = nz(p.priceChange?.m5), pc1 = nz(p.priceChange?.h1), pc24 = nz(p.priceChange?.h24);
  const liq = nz(p.liquidity?.usd), fdv = nz(p.fdv);
  const now = Date.now(), ageMin = p.pairCreatedAt ? Math.floor((now - p.pairCreatedAt)/60000) : null;
  const buy5 = (b5 + s5) ? b5/(b5+s5) : 0.5;
  const buy1 = (b1 + s1) ? b1/(b1+s1) : 0.5;
  const net1 = b1 - s1;
  const accVol = v24>0 ? (v1*24)/v24 : 0;
  const liqToFDV = fdv>0 ? liq/fdv : 0;
  return Object.assign(p, { _b5:b5,_s5:s5,_b1:b1,_s1:s1,_v5:v5,_v1:v1,_v24:v24,_pc5:pc5,_pc1:pc1,_pc24:pc24,_liq:liq,_fdv:fdv,_age:ageMin,_buy5:buy5,_buy1:buy1,_net1:net1,_accVol:accVol,_liqToFDV:liqToFDV });
}

// Hard-filters
function passTakeover(p){
  const liqToFDVMin = 0.008;
  return p._age!=null && p._age>=60 && p._age<=4320 &&
    p._fdv>=50000 && p._fdv<= Number(F.fdvMax.value || 500000) &&
    p._liq>= Number(F.liq.value || 5000) && p._liqToFDV>= liqToFDVMin &&
    p._pc1>= Number(F.pc1.value || 40) && p._pc5>= Number(F.pc5.value || 8) &&
    p._buy1>= Number(F.br1.value || 0.60) && p._buy5>= 0.55 &&
    p._b1>=25 && p._accVol>=2.5 &&
    p._pc5<= Number(F.pc5max.value || 120) && (p._v5>= Number(F.v5.value || 1000) || p._b5>=8);
}
function passRevival(p){
  const minAgeMin = (Number(F.ageDays.value || 7))*24*60;
  return p._age!=null && p._age>= minAgeMin &&
    p._pc1>=15 && p._pc24<= Number(F.pc24max.value || 5) &&
    p._accVol>= Number(F.acc.value || 3) &&
    p._buy5 >= (p._buy1 + 0.05) &&
    p._liq>= Math.max(10000, Number(F.liq.value || 5000)) && p._liqToFDV>=0.005 &&
    p._fdv<=10000000 &&
    p._pc5<= Number(F.pc5max.value || 120) && (p._v5>= Number(F.v5.value || 1000) || p._b5>=8);
}

// Scores
function scoreTakeover(p){
  const sMomentum = 0.6*clamp01(p._pc1/60) + 0.4*clamp01(p._pc5/12);
  const sBuy = 0.6*clamp01((p._buy1-0.5)*2) + 0.4*clamp01((p._buy5-0.5)*2);
  const sNet = clamp01(p._net1/20);
  const sAcc = 0.6*clamp01(Math.log2(Math.max(1,p._accVol))/2) + 0.4*clamp01(p._v1/100000);
  const sLP  = 0.7*clamp01(p._liq/50000) + 0.3*clamp01(p._liqToFDV/0.02);
  const score = 100*((0.35)*(0.7*sMomentum+0.3*sNet) + (0.35)*(sBuy) + (0.20)*(sAcc) + (0.10)*(sLP));
  return Math.round(score);
}
function scoreRevival(p){
  const sTurn = 0.7*clamp01(p._pc1/25) + 0.3*(p._pc24<=0 ? 1 : clamp01((5-p._pc24)/5));
  const sFlow = 0.6*clamp01(Math.log2(Math.max(1,p._accVol))/2) + 0.4*clamp01((p._buy5-p._buy1+0.1)/0.3);
  const sStab = 0.6*clamp01(p._liq/60000) + 0.4*clamp01(p._liqToFDV/0.02);
  const sPart = 0.6*clamp01(p._b1/60) + 0.4*clamp01((p._net1)/25);
  const score = 100*((0.35)*sTurn + (0.35)*sFlow + (0.15)*sStab + (0.15)*sPart);
  return Math.round(score);
}

function scorePairs(pairs, mode){
  const enrichAll = (pairs||[]).map(enrich);
  const filterFn = mode==='takeover' ? passTakeover : passRevival;
  const scored = enrichAll.filter(filterFn).map(p => {
    p._score = mode==='takeover' ? scoreTakeover(p) : scoreRevival(p);
    return p;
  }).sort((a,b)=> b._score - a._score);
  const limit = Number(F.limit.value || 150);
  return scored.slice(0, limit);
}

// ========= Render =========
function ampel(score){
  if (score>=75) return '<span class="ampel green">🟢</span>';
  if (score>=55) return '<span class="ampel yellow">🟡</span>';
  return '<span class="ampel red">🔴</span>';
}

function render(rows){
  elList.innerHTML = '';
  if (!rows.length){
    const div = document.createElement('div');
    div.className = 'muted';
    div.style.padding = '16px';
    div.textContent = 'Keine Treffer mit den aktuellen Filtern.';
    elList.appendChild(div);
    return;
  }
  rows.forEach(p=>{
    const age = (p._age==null) ? '–' : (p._age<60? `${p._age}m` : `${Math.floor(p._age/60)}h`);
    const buyTxt = `${Math.round(p._buy1*100)}/${Math.round(p._buy5*100)}`;
    const ch5cls = p._pc5>=0 ? 'good' : 'bad';
    const row = document.createElement('div');
    row.className = 'card';
    row.innerHTML = `
      <div class="row">
        <span class="pill">${p.baseToken?.symbol||'?'}</span>
        <span class="muted">/ ${p.quoteToken?.symbol||''}</span>
        <span class="badge">Age ${age}</span>
        <span class="badge">FDV $${fmt(p._fdv,0)}</span>
        <span class="badge">LP $${fmt(p._liq,0)}</span>
        <span class="badge">AccVol ×${fmt(p._accVol,2)}</span>
      </div>
      <div><span class="score">${ampel(p._score)} ${p._score}</span></div>
      <div>Δ 5m <b class="${ch5cls}">${fmt(p._pc5,2)}%</b></div>
      <div>Δ 1h <b class="${p._pc1>=0?'good':'bad'}">${fmt(p._pc1,2)}%</b></div>
      <div>Vol 5m <b>$${fmt(p._v5,0)}</b></div>
      <div>Vol 1h <b>$${fmt(p._v1,0)}</b></div>
      <div>Buys/Sells 1h <b>${p._b1}/${p._s1}</b></div>
      <div>Buy% 1h/5m <b>${buyTxt}</b></div>
      <div class="right"><a href="${p.url}" target="_blank" rel="noopener">Dexscreener ↗</a></div>
    `;
    elList.appendChild(row);
  });
}

// ========= Loop =========
async function refresh(){
  try{
    elErr.style.display='none';
    const pairs = await fetchPairs();
    const rows = scorePairs(pairs, MODE);
    render(rows);
    elLastUpd.textContent = new Date().toLocaleTimeString();
  }catch(e){
    elErr.style.display='block';
    elErr.textContent = 'Fehler: ' + e.message;
  }
}
function start(){
  clearInterval(timer);
  const sec = Math.max(5, Number(F.interval.value || 15));
  refresh();
  timer = setInterval(refresh, sec*1000);
}
start();
</script>
</body>
</html>
